GTEST_DIR = ../../../gtest
GTEST_INC = $(GTEST_DIR)/include

#choose based on system
GTEST_LIB = $(GTEST_DIR)/lib/gtest64.a          #class virtual machine uses this
#GTEST_LIB = $(GTEST_DIR)/lib/gtest32.a
#GTEST_LIB = $(GTEST_DIR)/lib/gtest_yosemite.a  #for Apple users

CXX = g++
CXXFLAGS = -g -I $(GTEST_INC) -std=c++11 -Wall -Werror -fmax-errors=1 -Wno-sign-compare
DEFS?= -DPHASE_A
DEFS?= -DPHASE_B

SRCS = $(shell ls *.cpp)
OBJS = $(patsubst %.cpp, %.o, $(SRCS))
DEPS = $(patsubst %.cpp, %.d, $(SRCS))
BINDIR = bin
TEST = vector_unittest
DOCDIR = doc

all: $(TEST)

test: $(TEST)
	@./$(BINDIR)/$(TEST)

$(TEST): $(OBJS) | $(BINDIR) $(DOCDIR)
	$(CXX) $^ $(EXTRA_TESTS) $(GTEST_LIB) $(DEFS) $(CXXFLAGS) -pthread -o $(BINDIR)/$@
	cldoc generate $(CXXFLAGS) -- --output $(DOCDIR) Vector.h

$(BINDIR):
	mkdir $(BINDIR)

$(DOCDIR):
	mkdir $(DOCDIR)

#<Automatic Dependency Generation>
-include $(DEPS)

%.d: %.cpp
	@$(CXX) $< $(CXXFLAGS) -MM > $@

%.o: %.d
	$(CXX) $*.cpp $(DEFS) $(CXXFLAGS) -c -o $@
#<\Automatic Dependency Generation>

clean:
	-rm -rf *.o *d $(TEST)
	-rm -rf $(BINDIR) $(DOCDIR)
